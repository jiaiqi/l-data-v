# Sheet Editor ä¼˜åŒ–ç‰ˆç»„ä»¶

è¿™æ˜¯å¯¹åŸå§‹ `sheet-editor/index.vue` ç»„ä»¶çš„ä¼˜åŒ–é‡æ„ç‰ˆæœ¬ï¼Œé‡‡ç”¨äº†æ¨¡å—åŒ–è®¾è®¡å’Œ Vue 3 Composition APIï¼Œæé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
sheet-editor/
â”œâ”€â”€ components/                    # å­ç»„ä»¶ç›®å½•
â”‚   â”œâ”€â”€ dialogs/                  # å¼¹çª—ç»„ä»¶
â”‚   â”‚   â””â”€â”€ index.vue            # å¼¹çª—ç®¡ç†ç»„ä»¶
â”‚   â”œâ”€â”€ pagination/              # åˆ†é¡µç»„ä»¶
â”‚   â”‚   â””â”€â”€ index.vue            # åˆ†é¡µç»„ä»¶
â”‚   â”œâ”€â”€ table-container/         # è¡¨æ ¼å®¹å™¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ index.vue            # è¡¨æ ¼ç»„ä»¶
â”‚   â””â”€â”€ toolbar/                 # å·¥å…·æ ç»„ä»¶
â”‚       â”œâ”€â”€ index.vue            # å·¥å…·æ ä¸»ç»„ä»¶
â”‚       â”œâ”€â”€ toolbar-actions.vue  # å·¥å…·æ æ“ä½œæŒ‰é’®
â”‚       â”œâ”€â”€ toolbar-add-section.vue # æ·»åŠ è¡ŒåŒºåŸŸ
â”‚       â”œâ”€â”€ toolbar-color-map.vue    # é¢œè‰²å›¾ä¾‹
â”‚       â”œâ”€â”€ toolbar-grid-buttons.vue # ç½‘æ ¼æŒ‰é’®
â”‚       â””â”€â”€ toolbar-list-type.vue    # åˆ—è¡¨ç±»å‹åˆ‡æ¢
â”œâ”€â”€ composables/                 # ç»„åˆå¼å‡½æ•°
â”‚   â”œâ”€â”€ useBroadcastChannel.js  # å¹¿æ’­é€šé“ç®¡ç†
â”‚   â”œâ”€â”€ useEditorState.js       # ç¼–è¾‘å™¨çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ useTableConfig.js       # è¡¨æ ¼é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ useTableData.js         # è¡¨æ ¼æ•°æ®ç®¡ç†
â”‚   â””â”€â”€ useTableEvents.js       # è¡¨æ ¼äº‹ä»¶ç®¡ç†
â”œâ”€â”€ utils/                       # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ cellStyleHandler.js     # å•å…ƒæ ¼æ ·å¼å¤„ç†
â”‚   â””â”€â”€ tableEventHandlers.js   # è¡¨æ ¼äº‹ä»¶å¤„ç†
â”œâ”€â”€ index.vue                   # åŸå§‹ç»„ä»¶
â””â”€â”€ sheet-editor-optimized.vue  # ä¼˜åŒ–ç‰ˆä¸»ç»„ä»¶
```

## ğŸš€ ä¸»è¦ä¼˜åŒ–ç‚¹

### 1. ç»„ä»¶æ‹†åˆ†
- **å·¥å…·æ ç»„ä»¶**: å°†å·¥å…·æ åŠŸèƒ½æ‹†åˆ†ä¸ºå¤šä¸ªå­ç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶è´Ÿè´£ç‰¹å®šåŠŸèƒ½
- **è¡¨æ ¼ç»„ä»¶**: ç‹¬ç«‹çš„è¡¨æ ¼å®¹å™¨ç»„ä»¶ï¼Œä¸“æ³¨äºè¡¨æ ¼æ¸²æŸ“å’Œäº¤äº’
- **å¼¹çª—ç»„ä»¶**: ç»Ÿä¸€ç®¡ç†å„ç§å¼¹çª—å’Œå¯¹è¯æ¡†
- **åˆ†é¡µç»„ä»¶**: ç‹¬ç«‹çš„åˆ†é¡µåŠŸèƒ½ç»„ä»¶

### 2. çŠ¶æ€ç®¡ç†ä¼˜åŒ–
- **useTableData**: ç®¡ç†è¡¨æ ¼æ•°æ®çš„åŠ è½½ã€ä¿å­˜ã€åˆ·æ–°ç­‰æ“ä½œ
- **useTableConfig**: ç®¡ç†è¡¨æ ¼é…ç½®é€‰é¡¹
- **useTableEvents**: ç®¡ç†è¡¨æ ¼äº‹ä»¶å¤„ç†é€»è¾‘
- **useEditorState**: ç®¡ç†ç¼–è¾‘å™¨çŠ¶æ€
- **useBroadcastChannel**: ç®¡ç†è·¨æ ‡ç­¾é¡µé€šä¿¡

### 3. ä»£ç å¤ç”¨
- **å·¥å…·å‡½æ•°**: æå–é€šç”¨çš„æ ·å¼å¤„ç†å’Œäº‹ä»¶å¤„ç†é€»è¾‘
- **ç»„åˆå¼å‡½æ•°**: å°†ç›¸å…³é€»è¾‘å°è£…ä¸ºå¯å¤ç”¨çš„ç»„åˆå¼å‡½æ•°

### 4. æ€§èƒ½ä¼˜åŒ–
- **æŒ‰éœ€åŠ è½½**: ç»„ä»¶æŒ‰éœ€åŠ è½½ï¼Œå‡å°‘åˆå§‹åŒ…å¤§å°
- **äº‹ä»¶ä¼˜åŒ–**: ä¼˜åŒ–äº‹ä»¶å¤„ç†é€»è¾‘ï¼Œå‡å°‘ä¸å¿…è¦çš„é‡æ¸²æŸ“
- **çŠ¶æ€ä¼˜åŒ–**: ä½¿ç”¨ reactive å’Œ ref è¿›è¡Œç²¾ç¡®çš„å“åº”å¼æ§åˆ¶

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨

```vue
<template>
  <sheet-editor-optimized
    :disabled="false"
    :child-list-type="childListType"
    @data-change="handleDataChange"
    @save="handleSave"
  />
</template>

<script>
import SheetEditorOptimized from './sheet-editor-optimized.vue'

export default {
  components: {
    SheetEditorOptimized
  },
  data() {
    return {
      childListType: null
    }
  },
  methods: {
    handleDataChange(data) {
      console.log('æ•°æ®å˜æ›´:', data)
    },
    handleSave(data) {
      console.log('ä¿å­˜æ•°æ®:', data)
    }
  }
}
</script>
```

### Props

| å±æ€§ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| disabled | Boolean | false | æ˜¯å¦ç¦ç”¨ç¼–è¾‘ |
| childListType | String | null | å­åˆ—è¡¨ç±»å‹ |

### Events

| äº‹ä»¶å | å‚æ•° | è¯´æ˜ |
|--------|------|------|
| data-change | data | æ•°æ®å˜æ›´æ—¶è§¦å‘ |
| save | data | ä¿å­˜æ•°æ®æ—¶è§¦å‘ |
| refresh | - | åˆ·æ–°æ•°æ®æ—¶è§¦å‘ |
| cell-click | { row, column, rowIndex, columnIndex } | å•å…ƒæ ¼ç‚¹å‡»æ—¶è§¦å‘ |
| row-click | { row, rowIndex } | è¡Œç‚¹å‡»æ—¶è§¦å‘ |

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### è¡¨æ ¼é…ç½®

å¯ä»¥é€šè¿‡ä¿®æ”¹ `useTableConfig.js` æ¥è‡ªå®šä¹‰è¡¨æ ¼é…ç½®ï¼š

```javascript
// è‡ªå®šä¹‰è™šæ‹Ÿæ»šåŠ¨é…ç½®
const tableOptions = computed(() => ({
  virtualScrollOption: {
    enable: true,
    scrolling: (data) => {
      // è‡ªå®šä¹‰æ»šåŠ¨å¤„ç†é€»è¾‘
    }
  }
}))
```

### æ ·å¼è‡ªå®šä¹‰

å¯ä»¥é€šè¿‡ä¿®æ”¹ `cellStyleHandler.js` æ¥è‡ªå®šä¹‰å•å…ƒæ ¼æ ·å¼ï¼š

```javascript
// è‡ªå®šä¹‰å•å…ƒæ ¼æ ·å¼
export function createCellStyleHandler(tableData, oldTableData) {
  return ({ row, column, rowIndex, columnIndex }) => {
    const classes = []
    
    // æ·»åŠ è‡ªå®šä¹‰æ ·å¼é€»è¾‘
    if (row.customFlag) {
      classes.push('custom-style')
    }
    
    return classes.join(' ')
  }
}
```

## ğŸ¯ è¿ç§»æŒ‡å—

ä»åŸå§‹ç»„ä»¶è¿ç§»åˆ°ä¼˜åŒ–ç‰ˆç»„ä»¶ï¼š

1. **æ›¿æ¢ç»„ä»¶å¼•ç”¨**:
   ```javascript
   // åŸæ¥
   import SheetEditor from './sheet-editor/index.vue'
   
   // ç°åœ¨
   import SheetEditorOptimized from './sheet-editor/sheet-editor-optimized.vue'
   ```

2. **æ›´æ–°äº‹ä»¶å¤„ç†**:
   ```javascript
   // åŸæ¥çš„äº‹ä»¶å¯èƒ½éœ€è¦é‡æ–°æ˜ å°„
   // å‚è€ƒæ–°ç»„ä»¶çš„äº‹ä»¶æ–‡æ¡£è¿›è¡Œè°ƒæ•´
   ```

3. **æ£€æŸ¥è‡ªå®šä¹‰æ ·å¼**:
   ```css
   /* ç¡®ä¿è‡ªå®šä¹‰æ ·å¼ä¸æ–°çš„ç±»ååŒ¹é… */
   .cell-add { /* æ–°å¢å•å…ƒæ ¼æ ·å¼ */ }
   .cell-update { /* æ›´æ–°å•å…ƒæ ¼æ ·å¼ */ }
   ```

## ğŸ› å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰å·¥å…·æ æŒ‰é’®ï¼Ÿ
A: åœ¨ `toolbar/toolbar-actions.vue` ä¸­æ·»åŠ æ–°çš„æŒ‰é’®ç»„ä»¶ã€‚

### Q: å¦‚ä½•è‡ªå®šä¹‰å•å…ƒæ ¼ç¼–è¾‘å™¨ï¼Ÿ
A: ä¿®æ”¹ `dialogs/index.vue` ä¸­çš„ `field-editor` ç»„ä»¶é…ç½®ã€‚

### Q: å¦‚ä½•å¤„ç†å¤§æ•°æ®é‡çš„æ€§èƒ½é—®é¢˜ï¼Ÿ
A: å¯ç”¨è™šæ‹Ÿæ»šåŠ¨åŠŸèƒ½ï¼Œåœ¨ `useTableConfig.js` ä¸­è®¾ç½® `virtualScrollOption.enable = true`ã€‚

## ğŸ“ å¼€å‘è¯´æ˜

### æ·»åŠ æ–°åŠŸèƒ½

1. **æ–°å¢ç»„åˆå¼å‡½æ•°**: åœ¨ `composables/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„ç»„åˆå¼å‡½æ•°
2. **æ–°å¢å·¥å…·å‡½æ•°**: åœ¨ `utils/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„å·¥å…·å‡½æ•°
3. **æ–°å¢å­ç»„ä»¶**: åœ¨ `components/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„å­ç»„ä»¶

### ä»£ç è§„èŒƒ

- ä½¿ç”¨ Vue 3 Composition API
- éµå¾ªå•ä¸€èŒè´£åŸåˆ™
- ä¿æŒç»„ä»¶çš„çº¯å‡€æ€§
- æ·»åŠ é€‚å½“çš„æ³¨é‡Šå’Œæ–‡æ¡£

## ğŸ”„ ç‰ˆæœ¬å†å²

- **v1.0.0**: åˆå§‹ä¼˜åŒ–ç‰ˆæœ¬ï¼Œå®ŒæˆåŸºæœ¬çš„ç»„ä»¶æ‹†åˆ†å’ŒçŠ¶æ€ç®¡ç†ä¼˜åŒ–
- **v1.1.0**: æ·»åŠ å¹¿æ’­é€šé“æ”¯æŒï¼Œä¼˜åŒ–äº‹ä»¶å¤„ç†æœºåˆ¶
- **v1.2.0**: å®Œå–„å·¥å…·å‡½æ•°ï¼Œæå‡ä»£ç å¤ç”¨æ€§

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æäº¤ Issueã€‚